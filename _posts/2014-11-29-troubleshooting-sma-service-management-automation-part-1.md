---
id: 3581
title: 'Troubleshooting SMA (Service Management Automation) &#8211; Part 1'
date: 2014-11-29T00:43:35+00:00
author: Michael Rüefli
layout: post
guid: http://www.miru.ch/?p=3581
permalink: /troubleshooting-sma-service-management-automation-part-1/
bfa_virtual_template:
  - hierarchy
s2mail:
  - 'yes'
categories:
  - Cloud and Datacenter Management
  - Service Management Automation
  - System Center
tags:
  - Service Management Automation
  - SMA
  - System Center
---
As I work more and more with SMA in my daily job, I&#8217;m of course also running into situations where things go wrong. I decided to share some troubleshooting tips and therefore, this is the first post in a series of 3, explaing how to troubleshoot SMA infrastructure, failing jobs, stuck / stalled jobs, etc.

In this post I&#8217; going to focus on the job states and some insights how SMA distributes them. If you should have no clue what I&#8217;m writing about, have a look <a title="SMA Whitepaper" href="https://gallery.technet.microsoft.com/Service-Management-fcd75828" target="_blank">here</a>.

## Job States

SMA has different states for jobs as they are executed.

  * **1** = QUEUED
  
    When a runbook has been assigned to a worker, but waits to get picked up (wait for execution)
  * **2** = STARTING (ACTIVATING)
  
    When a runbook gets started, a new instance of a runbook job is created and assigned to a runbook worker
  * **3 **= RUNNING
  
    Runbook is currently executed on the assigned worker
  * **4** = COMPLETED
  
    The runbook has finished without any terminating errors
  * **5** = FAILED
  
    The runbook execution failed (usually due to an internal error or runbook code syntax error)
  * **6** = STOPPED
  
    The runbook failed because of a terminating error condition
  * **8** = SUSPENDED
  
    The runbook has paused (suspended) either caused by a manual suspend call or due to a non terminating error
  * **11** = STOPPING
  
    The runbook execution is terminated (sandbox is discarded)
  * **12** = RESUMING
  
    The runbook continues at the last good known state (workflow checkpoint) after a non terminating error or a manual suspend action

The job state info can be gathered via Powershell or TSQL against the SMA database.

Powershell example (requires the SMA Powershell module installed)

<pre> Get-SMAJob -WebServiceEndpoint "https://smaweb.domain.com" | where {$_.JobStatus -eq 'Failed'}</pre>

TSQL Example

<pre>USE [SMA]
SELECT * FROM[Core].[Jobs]
WHERE StatusId = 6</pre>

## How job execution works in SMA

Assuming you have muliple runbook workers deployed (hope you do), SMA distributes the runbook executions among all active workers. Static random partitions are used as adistribution mechanism. This basically means that each runbook is assigned to a runbook worker on launch time. Each worker has a fixed numbered range (queue). On launch time, the runbook gets assigned a random partition ID. The partition ID is nothing more than a random number which fits into one of the worker queue (partition numbering range).The pratitioning info can be found by querying the two tables: **Core.Job**s and **Queues.Deployment**

![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAz8AAAAmCAIAAABlBrLaAAANXUlEQVR4nO1d3WocuRLWI+Qmz+AHSGyYJnd5i0AIhu1+jYDBELIwmUfwVcDZzGahhwk+HEJ2SWB2T7ANvhnO4IuBhWQhhsY3Czvm6Fz0n6QqqdXT6um/+mh2Z9SSuuqTWvV1tcZh737+pe7jp2lIBx100EEHHXTQQYeTg60JBAKBQCAQCN0Bu6sN8QXq678K2mwbgaBDj+dt113ruv3NgtgjBlxhCEySemupbQSCDj2et113rev2NwtijxhwhSEwSeqtpbYRCDr0eN523bWu298siD1iwBWGwGRz6m05Ho3GS8tyqXA5HjGGtm3eNmNzAsEF3Mzbu+ROiuGH7uyrcEe03bUiIPYLlmxpzNbrSei7WSi1xjhbimP0n70i9J+B6u7YoRYmy6JmbdA99Rb6zogn9UboIhxJnNDPlubleMT80DBvS03p5tVbba4VAY8ZWf/bXStuVb5t6DPf97WNsg63HVyHS3GM/rNXhP4zANQ/PoMqs1qVScU7B87aXbcMOqbeluNRvY96FWwrbk4guEAD87Zb6q0+14pQEDPuQn8LvbOlhcvxyA/vQm34rSIFXC/FMfrPXhH6z4DSqmxO3RpVmbS004z+q7c8n+mHSbnvj+TsZlxZedbLG47GS+lBUHj03pVtUuXdZ9wJA4KbeavG37TNaLyM0yr5KwbhFPb8ml0tOVPhjmi7a1vYjz7xy2tXXD72meSGwp6QAyiomV3LD+XL567jjiPcYteqYSkeCnvEgCpfEhWlvSvVU1Y02jOpdi6tJ5l3acnWztajDRpXb8ssd5p8Wo5HTC65k5wHoknIbSYnbR9QnNkmVy63YhEIJeFm3qbflBiA57HEZUhdAdPbLeu6wh3Rdte2sF9cuBm4Ur52KSs+YM+mptyxtD5JPoQ+G41DxXETt2gccrgUD4U9YkClAlCj3JV34JQFjdZMYtdVVgx8lSjlbF3aoGn1BldMpSRfPVOpDMVsOhi5jLdbMZzZhla2JIhAKAk381aEuL7n1ZQHUJ3ESarmU77CHdF217awH/oO166wyC8x+hbWhNdAw6EuPpl7rmcpHgp7xIDaj/iApLmccsqCRlsmDdc1q7dSztamDXau3qoOebp46FZqP9S/qK/TNlJvhF3BzbyVEPrS1n5513+BxMm7YJWfZ9ruWln7Uavg2mXjV9lFSUpDygEeVm56KY7Rf/aIAcWd5Kv+roSnLGi0ZdJmNSD1JhSkfCX/X2IZSOF1vJy9TUtHYnZeqBf6leR5FdvkyqTeCLXBybyVQoCaoBJyJjanlBc6Fe6ItrtW2n60KTAaWd8Be9pIIPcmjoBkQrjNmy9z9HW3FA+FPWJA6jprUuautKDRmkn9dc3qrZyzdWmDJt6cJhsFBc0rJkWzr0zeQSn4vExeMWc7DvNzVTfJVrEtrzxyqK8JBAVu5q20Y1eIuMwP5RbZTnT1VDrPlatVuSPa7toW9uORW167dEu/aIw2+kISwCqYhA9x17nACXJFTKhhOtbVUjwU9ogB6fbLH7Ks7kr7+9CaSbVzSTWK3lW7WerRBk2otxpReZMsgdB69Hjedt21hu3f6g9K1INtTCH2iAFX6PpKYoMeqbfyqfohDDChf+jxvO26a03YL/7Rg3bk/Ld5a3p3R+wRA+7Q9ZXEBj1Sb+XRZtsIBB16PG+77lrX7W8WxB4x4ApDYJLUW0ttIxB06PG87bprXbe/WRB7xIArDIHJRL2tCQQCgUAgEHoEzlgvj8xBFtUJxlhr/0sgEAgEAqGXaFxm1XRcX19//fo1iqIac29RFP11c/vXze239h2MMU4gdA1RFDVtQl3oumtRFHG+pmO7g9gjBpwyyTnnsdY5Pz9f9AWxR4vF4vLy8u+//8vWtb0hjqKIMdZO9db1UEEYJno8b7vuGkXfyhG3eTOIgR4cinpbLBYfP3781AvEHoVheHZ29uef/6lXvVHujUBwiK5LHAO67hpF38oRt3kziIEeHFC9ffr06fz8/Kr7iD2aTqfT6fTq6t+UeyMQOoMez9uuu0bRt3LEbd4MYqAHB6rerq6urq+v69snthvEHs1mszdv3vz++wxXb//7Z/YD+2H2D6+o3sy5t9fP2MPji+xzgmdvlZKnp7f2dRzl3uYBC+bxx9XEYxLiE1mxN1llbcQKSlNzYdo+68xYE7scZmZWhck9C95hnsdVkQ5RKuRCpF+pQm5Gblww19EMKbUcpvgyyiW2LClyMGNMcAwUaPtTWZRaAhgkDnSkWyhQb4DVtkEbfVfPPfZgshK+es9XfM35ScCezPOa6de8AmzS24PYIwacMsk5V9Xber3+/v17FE2DvWCa/rJhGuzFyIpASVawt7f3+OVFQau46OLl4z0JwRTrJ6uWfMfqwN9hfPjw4d27d3/8AdXbZvXjozgIOFBvzJB7+/LiIUvV25cXD/dfLG5uv91cHO0fHH25/XZ6yJKSt0/Z4WvLOg5yb1kYFWQBjBqriZdUSGN3HsMTSbGaeIpWCeZ4YfYlCILspKGmeFlciq0mXiJ+lFPAO8x7JEjGHeqoyAtzXjCu8spCmaZJLD61PloMU14iXLWoBDHM7CBgTBlHq5GC00kD3bwt4LMLMKs3lVUF2RihU9RVEyOM0ZexLHxS9NVG3EGzRww4ZZJzDtXbby8f792/f//evWC22Ww2m80suPfo1TL5FMzQkvxDClBn+epRWkX4mGH56lEwQ/rJ62Y9gjoyYo8+f/78/v37y8t/NZV7uzjaP3j67CBRb6eHYjpNTqQJWq2wTk25N6NkiauKtVYTL5gXKx1wKpjzeaDIi2IgNZNetH3ocm+riecFAdLI1KFSiKooWaNCqaa0iC8HKDU6gvUiptMUNastgYaZHISMKeNodhQh1pQXtXu96EiN7BpG1wyspufL+uyaJlP09Z5PAhbMKfqaI+6g2SMGnDLJOUdyb1EUbTYzbInVP/2DM+bApAtnxvyCkPIxL0qpR2dnZ9p9b67Umzb3dnrInr1dHCfqLfugfE5TdIev7eq42/dWpN7y0rRmnjRZTTyGi6BC8aafMVrAVIuYVIAvLBXvgNPIlc1ZCrUQdI7l3kwOiNSKlCJ8mIZJuce8ycqmBDHM4CBkTBlHo6NILrBAvNmotz7m3hBWxRfF6UTPRlScL+lncRsB3sSbTJQ39eJL7qL70Rx9V1kEpeirjbiDZo8YcMok57yMekMXZ7CnJ3+Jog1M+nCGhGOw7GtDdopdqjdN7i150Vmo3hbHByzd02ZTZyf73pRyuJHLCwJNCkuvyTIJj+d7NIhNgNo/KZEnmVANlQha9Z93iFKhNkBVkDYGotNfzNTllBaqN9mwiuotN0zrIMKYOo4yB9qR4sh0QlGo3nQ6t/0wuAZYFefzPGDeZK4+YEjbN9GnY+WZZDXxRNEG36JXVG98PY/TJxR9tRF30OwRA06Z5Jzbqje4OEslWBjVBSZTOEPDsbLsa0N2isZzb1C0mfJqNxdH++zpqVWd3eXekKyJ1LikepNlkSIr5J6ZqgJslJly5bxO1qE+v1biJbJYPzdVMlAyD5MauP3xrAbu15V7kwzTOIgxBsZRZUozUsbpJMI8b7sr3bjJNYu7Aw4GfAxSEmlQvZVJzGrsN0Vfzk8CMYlC0VeNuINmjxhwyiTnvOybU8M7I3WZySDuU7YPZ2BxQtYXfMlpOvd2cbQvJXAeHl8Y97SlWs2mzq72vRkX9njUrZROXixJGr18w2ATZXTqTbSZySESaWjjExpZ88tJExZKDT1B+ne9upbb7ntTDcMdxBhDxlHrnc1nCHOCqrvSjRtcg6zOsTmmSmmlprDM6nJvtau39WrywAuepF9/nXjYbwkHGX2JPWLAKZOc81LqDQ9cRSV5YCoTzqwWmObVG5p7QyQX+D3p4vgg1WppXs2mzs5ybyDDKSdVg1K/OUXlAVpTrIP9xlDVWjD5q3oHIBtj+oYVYjJLMTDbJli0dRRSCmAcJvhkY1MCr1XkIJaEy8ttRqo4YZ5CO2+1FHUGhp/TAlbnhW9OefpEkn6TdbqNelNuMhfqjfOTgOW/H5xnW9H5ms+fsOAEj7UDiL7EHjHglEnOebF6g4uzsSRZppHAVCqcIX+nQnstFU3n3vCEmeFvuZWqU/++t+K/JSYmmphaCxaCcUrHEG0umqi+oAOqDKmD1pMvru0QpUIuxB9qQAVxCzkTd4Nq7NeYWyCyDWOkK0EMK3JQ0H34OJYaKbMG00kcnM9OQeOajlV03OSUt/wAJA2jN1kpTdAHYbGNG/W2Xk0e5H/9gf8q7FIW/iSEOJbBCVLSdICsJ+IOmj1iwCmTnHOr3BtcnEuVbBfOYD8wHuHrjY16cwL6txYIBLfo8bxttWsFPwXmnP6tBQcRt3kziIEeHEXqbVP7clEfdqne6N85JRAcotUSpxra55r4RF2czaToWzniNm8GMdCDg9SbG/VGuTcCwSF6PG+77hpF38oRt3kziIEeHKTe3Kg3yr0RCA7RdYljQNddo+hbOeI2bwYx0INjWOqtJlDujUBwix7P2667RtG3csRt3gxioAeHot76d2Tq7f/2UR0hy1uMEAAAAABJRU5ErkJggg==)

![](data:image/png;base64,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)

No least loaded, no round robin, just randomness kicks in.

After assigning the job to a worker, the RunbookService on the worker starts a process called **Orchestrator.Sandbox**. The process is in charge to compile and execute the runbook code.
  
Now Imagine something goes wrong with the worker. The Runbook service dies, the worker server goes down, what will happen to the runbooks currently being started or excecuted? Well, it depends 🙂

  * Runbooks which where in the Starting status will be started normally when the worker comes back online
  * Runbooks which where currently running will continue to run from their last good known state (checkpoint),  if there is one, otherwise they will fail

In no case the runbooks will get re-distributed to a remaining worker at any time, that&#8217;s why the mechanism behind is called &#8220;static random paritioned&#8221;

## A word on suspended runbooks

Suspended runbooks stay in this state forever, until someone or another runbook resumes or stops them. The database holds the state including all checkpoints of each suspended runbooks. I tend to keep the SMA jobs generally for a longer period than the default 30 days. But I really don&#8217;t want to have hundreds or thousands of runbooks in the suspended state consuming evetually huge amount of space regardinf the checkpoint states. I&#8217;m using a houskeeping runbook to cleanup runbooks which have been in a suspended state for a while.

Which looks like this:

<pre> Workflow Start-JobCleanup
{
    param(
    [Parameter(mandatory)]
    [string]$JobState,
    [Parameter(mandatory)]
    [int]$DaysToKeep
    )

    $SMAWebSvcURI = "https://smaweb"

    #Get all the runbooks matching the state
    $jobs = InlineScript
    {
        $jobs = Get-SmaJob -WebServiceEndpoint $USING:SMAWebSvcURI | ? {$_.JobStatus -eq "$USING:JobState"}
        return $jobs
    }

    Foreach -parallel ($j in $jobs)
    {
        If ((Get-Date).AddDays(-$DaysToKeep) -gt ([datetime]$j.LastModifiedTime))
        {
            Write-Output "SMA Job: $($j.JobId) will be stopped"
            Stop-SmaJob -Id $j.JobId -WebServiceEndpoint $SMAWebSvcURI
        }
    }
}</pre>

&nbsp;

In the next post I&#8217;ll show how to troubleshoot hung or stalled jobs and how to deal with &#8220;lost&#8221; workers.

Hope this already helped.

stay tuned!